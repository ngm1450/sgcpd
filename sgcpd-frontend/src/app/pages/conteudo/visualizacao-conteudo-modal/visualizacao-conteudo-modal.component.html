<!-- Backdrop (sem JS do Bootstrap, controlado via [open]) -->
<div class="modal-backdrop fade" [class.show]="open" *ngIf="open"></div>

<!-- Modal (padrão Bootstrap) -->
<div class="modal fade"
     [class.show]="open"
     [style.display]="open ? 'block' : 'none'"
     tabindex="-1"
     role="dialog"
     aria-modal="true"
     [attr.aria-hidden]="!open"
     (click)="onBackdropClick()"
     (keydown)="onKeydown($event)">

  <div class="modal-dialog modal-lg modal-dialog-centered" role="document" (click)="stop($event)">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title m-0">Visualizar conteúdo</h5>
        <button type="button" class="btn-close" aria-label="Fechar" (click)="close()"></button>
      </div>

      <div class="modal-body">
        <!-- estados -->
        <div *ngIf="loading" class="alert alert-info mb-3">Carregando…</div>
        <div *ngIf="error" class="alert alert-danger mb-3">{{ error }}</div>

        <ng-container *ngIf="!loading && !error && dados">
          <!-- Título -->
          <div class="mb-3">
            <label class="form-label">Título</label>
            <input class="form-control" [value]="dados.titulo" disabled>
          </div>

          <!-- Corpo -->
          <div class="mb-3">
            <label class="form-label">Corpo</label>
            <div class="conteudo-renderizado">
              <div class="form-control ql-container ql-snow">
                <div class="ql-editor" [innerHTML]="dados.corpo"></div>
              </div>
            </div>
          </div>

          <!-- Categoria + Status + Autor/Atualização -->
          <div class="row g-3 mb-3">
            <div class="col-12 col-md-4">
              <label class="form-label">Categoria</label>
              <input class="form-control" [value]="dados.nomeCategoria || '—'" disabled>
            </div>

            <div class="col-12 col-md-4">
              <label class="form-label">Status</label>
              <input class="form-control" [value]="dados.status" disabled>
            </div>

            <div class="col-12 col-md-4">
              <label class="form-label">Último editor</label>
              <input class="form-control" [value]="dados.nomeAutor || '—'" disabled>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-12 col-md-6">
              <label class="form-label">Atualizado em</label>
              <input class="form-control" [value]="(dados.dataAtualizacao | date:'dd/MM/yyyy HH:mm')" disabled>
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Criado em</label>
              <input class="form-control" [value]="(dados.dataCriacao | date:'dd/MM/yyyy HH:mm')" disabled>
            </div>
          </div>

          <!-- Tags -->
          <div class="mb-2">
            <label class="form-label d-block">Tags</label>
            <div *ngIf="!dados.idsTags?.length" class="form-text">Nenhuma tag.</div>
            <div class="d-flex flex-wrap gap-2" *ngIf="dados.idsTags?.length">
              <span class="badge text-bg-secondary" *ngFor="let t of dados.idsTags; let i = index">
                {{ dados.tagNames[i] }}
              </span>
            </div>
          </div>

          <div class="mt-3" *ngIf="dados.arquivos?.length">
            <label for="anexos" class="form-label">Anexos</label>
            <!-- lista dos arquivos escolhidos -->
            <ul class="list-group list-group-flush" *ngIf="dados.arquivos?.length">
              <li class="d-flex justify-content-between align-items-center"
                  *ngFor="let f of dados.arquivos; index as i">
                  <span class="text-truncate" style="max-width: 75%;">
                    {{ f.nome }}
                    <small class="text-muted">
                      ({{ f.tamanho / (1024 * 1024) | number:'1.2-2' }} MB)
                    </small>
                  </span>
                <button type="button"
                        class="btn btn-sm btn-outline-primary"
                        (click)="arquivoService.baixarArquivo(f.id, f.nome)"
                        title="Baixar arquivo">
                  Baixar
                </button>
              </li>
            </ul>
          </div>
        </ng-container>
      </div>

      <div class="modal-footer">
        <button class="btn btn-primary" (click)="close()">Fechar</button>
      </div>
    </div>
  </div>
</div>
